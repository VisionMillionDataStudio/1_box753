# å¿«é€’ç›’æ£€æµ‹æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunmasj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://kdocs.cn/l/cszuIiCKVNis)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€ç”µå­å•†åŠ¡çš„è¿…çŒ›å‘å±•ï¼Œå¿«é€’è¡Œä¸šä¹Ÿéšä¹‹è“¬å‹ƒå…´èµ·ï¼Œå¿«é€’åŒ…è£¹çš„æ•°é‡æ—¥ç›Šå¢åŠ ã€‚æ ¹æ®ç»Ÿè®¡æ•°æ®ï¼Œå…¨çƒå¿«é€’å¸‚åœºçš„å¹´å¢é•¿ç‡å·²è¶…è¿‡10%ï¼Œé¢„è®¡åœ¨æœªæ¥å‡ å¹´å†…å°†ç»§ç»­ä¿æŒè¿™ä¸€å¢é•¿è¶‹åŠ¿ã€‚åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹ï¼Œå¿«é€’åŒ…è£¹çš„ç®¡ç†å’Œå¤„ç†æ•ˆç‡æˆä¸ºäº†è¡Œä¸šå†…äºŸå¾…è§£å†³çš„é‡è¦é—®é¢˜ã€‚ä¼ ç»Ÿçš„å¿«é€’åŒ…è£¹æ£€æµ‹æ–¹æ³•å¾€å¾€ä¾èµ–äººå·¥æ“ä½œï¼Œä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”å®¹æ˜“å—åˆ°äººä¸ºå› ç´ çš„å½±å“ï¼Œå¯¼è‡´é”™è¯¯ç‡è¾ƒé«˜ã€‚å› æ­¤ï¼ŒåŸºäºè®¡ç®—æœºè§†è§‰çš„è‡ªåŠ¨åŒ–æ£€æµ‹ç³»ç»Ÿåº”è¿è€Œç”Ÿï¼Œæˆä¸ºæå‡å¿«é€’å¤„ç†æ•ˆç‡å’Œå‡†ç¡®æ€§çš„é‡è¦æ‰‹æ®µã€‚

åœ¨ä¼—å¤šè®¡ç®—æœºè§†è§‰æŠ€æœ¯ä¸­ï¼Œç›®æ ‡æ£€æµ‹æŠ€æœ¯å› å…¶åœ¨å®æ—¶æ€§å’Œå‡†ç¡®æ€§æ–¹é¢çš„ä¼˜åŠ¿ï¼Œé€æ¸æˆä¸ºå¿«é€’åŒ…è£¹æ£€æµ‹çš„ä¸»æµé€‰æ‹©ã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹ä»¥å…¶é«˜æ•ˆçš„ç‰¹æ€§å—åˆ°å¹¿æ³›å…³æ³¨ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç»“åˆäº†æ·±åº¦å­¦ä¹ çš„å…ˆè¿›æŠ€æœ¯ï¼Œèƒ½å¤Ÿåœ¨ä¿æŒé«˜ç²¾åº¦çš„åŒæ—¶å®ç°å¿«é€Ÿçš„ç›®æ ‡æ£€æµ‹ã€‚ç„¶è€Œï¼Œå°½ç®¡YOLOv8åœ¨å¤šç§åº”ç”¨åœºæ™¯ä¸­è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨ç‰¹å®šé¢†åŸŸå¦‚å¿«é€’ç›’æ£€æµ‹ä¸­ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›æŒ‘æˆ˜ï¼Œä¾‹å¦‚å¯¹ä¸åŒå°ºå¯¸ã€å½¢çŠ¶å’Œé¢œè‰²çš„å¿«é€’ç›’çš„è¯†åˆ«èƒ½åŠ›ï¼Œä»¥åŠåœ¨å¤æ‚èƒŒæ™¯ä¸‹çš„æ£€æµ‹å‡†ç¡®æ€§ç­‰ã€‚å› æ­¤ï¼Œé’ˆå¯¹å¿«é€’ç›’æ£€æµ‹ä»»åŠ¡å¯¹YOLOv8è¿›è¡Œæ”¹è¿›å’Œä¼˜åŒ–ï¼Œå…·æœ‰é‡è¦çš„ç ”ç©¶æ„ä¹‰ã€‚

æœ¬ç ”ç©¶æ‰€ä½¿ç”¨çš„æ•°æ®é›†åŒ…å«7815å¼ å›¾åƒï¼Œæ¶µç›–äº†å››ä¸ªç±»åˆ«çš„å¿«é€’ç›’ï¼Œåˆ†åˆ«ä¸º0ã€1ã€15å’Œboxã€‚è¿™ä¸€æ•°æ®é›†çš„æ„å»ºä¸ºæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°æä¾›äº†ä¸°å¯Œçš„æ ·æœ¬ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæ”¯æŒç›®æ ‡æ£€æµ‹ç®—æ³•çš„ä¼˜åŒ–ä¸æ”¹è¿›ã€‚é€šè¿‡å¯¹æ•°æ®é›†çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºå¿«é€’ç›’åœ¨ä¸åŒç¯å¢ƒä¸‹çš„ç‰¹å¾ï¼Œè¿›è€Œé’ˆå¯¹æ€§åœ°è°ƒæ•´YOLOv8çš„ç½‘ç»œç»“æ„å’Œå‚æ•°è®¾ç½®ï¼Œä»¥æé«˜å…¶åœ¨å¿«é€’ç›’æ£€æµ‹ä¸­çš„è¡¨ç°ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†çš„å¤šæ ·æ€§ä¹Ÿä¸ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›æä¾›äº†ä¿éšœï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨å®é™…åº”ç”¨ä¸­é€‚åº”ä¸åŒçš„å¿«é€’åœºæ™¯ã€‚

æœ¬ç ”ç©¶çš„æ„ä¹‰ä¸ä»…åœ¨äºæå‡å¿«é€’ç›’çš„æ£€æµ‹ç²¾åº¦å’Œæ•ˆç‡ï¼Œæ›´åœ¨äºæ¨åŠ¨å¿«é€’è¡Œä¸šçš„æ™ºèƒ½åŒ–è¿›ç¨‹ã€‚é€šè¿‡å¼•å…¥å…ˆè¿›çš„ç›®æ ‡æ£€æµ‹æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¿«é€’åŒ…è£¹çš„è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œé™ä½äººå·¥æˆæœ¬ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œè¿›è€Œä¸ºå¿«é€’è¡Œä¸šçš„å¯æŒç»­å‘å±•æä¾›æœ‰åŠ›æ”¯æŒã€‚åŒæ—¶ï¼Œç ”ç©¶æˆæœä¹Ÿå°†ä¸ºå…¶ä»–é¢†åŸŸçš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡æä¾›å€Ÿé‰´ï¼Œæ¨åŠ¨è®¡ç®—æœºè§†è§‰æŠ€æœ¯çš„å¹¿æ³›åº”ç”¨ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„å¿«é€’ç›’æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„ç†è®ºä»·å€¼ï¼Œä¹Ÿå…·å¤‡æ˜¾è‘—çš„å®é™…åº”ç”¨å‰æ™¯ã€‚é€šè¿‡æ·±å…¥æ¢è®¨å’Œä¼˜åŒ–ç›®æ ‡æ£€æµ‹æŠ€æœ¯ï¼Œæˆ‘ä»¬æœŸå¾…èƒ½å¤Ÿä¸ºå¿«é€’è¡Œä¸šçš„æ™ºèƒ½åŒ–è½¬å‹è´¡çŒ®ä¸€ä»½åŠ›é‡ï¼ŒåŒæ—¶ä¸ºç›¸å…³é¢†åŸŸçš„ç ”ç©¶æä¾›æ–°çš„æ€è·¯å’Œæ–¹æ³•ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1qvxhe6EYp/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 4
names: ['0', '1', '15', 'box']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åä¸ºâ€œ1_boxâ€çš„æ•°æ®é›†ï¼Œä»¥æ”¹è¿›YOLOv8çš„å¿«é€’ç›’æ£€æµ‹ç³»ç»Ÿã€‚è¯¥æ•°æ®é›†ä¸“é—¨ä¸ºå¿«é€’ç›’çš„æ£€æµ‹ä»»åŠ¡è€Œè®¾è®¡ï¼ŒåŒ…å«äº†ä¸°å¯Œçš„æ ·æœ¬å’Œå¤šæ ·çš„åœºæ™¯ï¼Œæ—¨åœ¨æé«˜æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚æ•°æ®é›†çš„ç±»åˆ«æ•°é‡ä¸ºå››ä¸ªï¼Œå…·ä½“ç±»åˆ«åŒ…æ‹¬â€œ0â€ã€â€œ1â€ã€â€œ15â€å’Œâ€œboxâ€ã€‚è¿™äº›ç±»åˆ«ä»£è¡¨äº†ä¸åŒç±»å‹çš„å¿«é€’ç›’ï¼Œæ¶µç›–äº†ä»å¸¸è§çš„æ ‡å‡†å¿«é€’ç›’åˆ°ç‰¹æ®Šå½¢çŠ¶å’Œå°ºå¯¸çš„åŒ…è£…ï¼Œç¡®ä¿äº†æ¨¡å‹åœ¨å¤šç§æƒ…å†µä¸‹çš„æœ‰æ•ˆæ€§ã€‚

â€œ1_boxâ€æ•°æ®é›†çš„æ„å»ºç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼ŒåŒ…å«äº†å¤§é‡çš„æ ‡æ³¨å›¾åƒï¼Œæ¶µç›–äº†å„ç§å…‰ç…§æ¡ä»¶ã€èƒŒæ™¯ç¯å¢ƒå’Œæ‹æ‘„è§’åº¦ã€‚è¿™äº›å›¾åƒä¸ä»…å±•ç¤ºäº†å¿«é€’ç›’çš„ä¸åŒå¤–è§‚ï¼Œè¿˜è€ƒè™‘äº†ä¸åŒçš„é®æŒ¡æƒ…å†µå’Œå¤æ‚çš„èƒŒæ™¯ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æ•°æ®é›†ä¸­çš„æ¯ä¸€å¼ å›¾åƒéƒ½ç»è¿‡ä¸“ä¸šæ ‡æ³¨ï¼Œç¡®ä¿äº†ç›®æ ‡ç‰©ä½“çš„å‡†ç¡®å®šä½å’Œç±»åˆ«è¯†åˆ«ã€‚è¿™ç§é«˜è´¨é‡çš„æ ‡æ³¨æ•°æ®ä¸ºYOLOv8æ¨¡å‹çš„è®­ç»ƒæä¾›äº†åšå®çš„åŸºç¡€ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨å¿«é€’ç›’æ£€æµ‹ä»»åŠ¡ä¸­å®ç°æ›´é«˜çš„å‡†ç¡®ç‡ã€‚

åœ¨æ•°æ®é›†çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å…¶åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œä»¥ä¾¿äºå¯¹æ¨¡å‹çš„æ€§èƒ½è¿›è¡Œè¯„ä¼°å’Œè°ƒä¼˜ã€‚è®­ç»ƒé›†åŒ…å«äº†å¤§éƒ¨åˆ†æ ·æœ¬ï¼Œç”¨äºæ¨¡å‹çš„å­¦ä¹ å’Œå‚æ•°ä¼˜åŒ–ï¼Œè€ŒéªŒè¯é›†åˆ™ç”¨äºå®æ—¶ç›‘æµ‹æ¨¡å‹åœ¨æœªè§æ•°æ®ä¸Šçš„è¡¨ç°ã€‚é€šè¿‡è¿™ç§åˆ’åˆ†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°é¿å…è¿‡æ‹Ÿåˆç°è±¡ï¼Œç¡®ä¿æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„å¯é æ€§ã€‚

ä¸ºäº†è¿›ä¸€æ­¥æå‡æ¨¡å‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬è¿˜å¯¹æ•°æ®é›†è¿›è¡Œäº†æ•°æ®å¢å¼ºå¤„ç†ã€‚è¿™åŒ…æ‹¬å›¾åƒçš„æ—‹è½¬ã€ç¼©æ”¾ã€è£å‰ªã€ç¿»è½¬ä»¥åŠé¢œè‰²è°ƒæ•´ç­‰æ“ä½œï¼Œä»¥å¢åŠ æ•°æ®çš„å¤šæ ·æ€§å’Œä¸°å¯Œæ€§ã€‚è¿™ç§å¢å¼ºç­–ç•¥ä¸ä»…æé«˜äº†æ¨¡å‹çš„é²æ£’æ€§ï¼Œè¿˜å¸®åŠ©æ¨¡å‹æ›´å¥½åœ°é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚åœ¨å¿«é€’æŠ•é€’è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„å„ç§å¤æ‚ç¯å¢ƒã€‚

æ­¤å¤–ï¼Œæ•°æ®é›†çš„è®¾è®¡ä¹Ÿè€ƒè™‘åˆ°äº†å¿«é€’è¡Œä¸šçš„å®é™…éœ€æ±‚ã€‚éšç€ç”µå­å•†åŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œå¿«é€’ç›’çš„ç§ç±»å’Œå½¢çŠ¶æ—¥ç›Šå¤šæ ·åŒ–ï¼Œå› æ­¤â€œ1_boxâ€æ•°æ®é›†çš„ç±»åˆ«è®¾ç½®æ¶µç›–äº†å¸¸è§çš„å¿«é€’ç›’ç±»å‹ï¼Œä½¿å¾—è®­ç»ƒå‡ºçš„æ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹å¸‚åœºä¸Šå„ç§å¿«é€’ç›’çš„æ£€æµ‹éœ€æ±‚ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—æˆ‘ä»¬çš„å¿«é€’ç›’æ£€æµ‹ç³»ç»Ÿåœ¨å®é™…åº”ç”¨ä¸­å…·æœ‰è¾ƒé«˜çš„å®ç”¨ä»·å€¼ã€‚

æ€»ä¹‹ï¼Œâ€œ1_boxâ€æ•°æ®é›†ä¸ºæ”¹è¿›YOLOv8çš„å¿«é€’ç›’æ£€æµ‹ç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„æ ·æœ¬å’Œé«˜è´¨é‡çš„æ ‡æ³¨ï¼Œç¡®ä¿äº†æ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°è¿‡ç¨‹çš„ç§‘å­¦æ€§å’Œæœ‰æ•ˆæ€§ã€‚é€šè¿‡å¯¹æ•°æ®é›†çš„åˆç†åˆ©ç”¨ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿæå‡å¿«é€’ç›’æ£€æµ‹çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ï¼Œä¸ºå¿«é€’è¡Œä¸šçš„æ™ºèƒ½åŒ–å‘å±•è´¡çŒ®åŠ›é‡ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOv8ï¼ˆYou Only Look Once version 8ï¼‰æ˜¯ç›®æ ‡æ£€æµ‹é¢†åŸŸçš„ä¸€é¡¹é‡è¦è¿›å±•ï¼Œå»ºç«‹åœ¨å‰å‡ ä»£YOLOç®—æ³•çš„åŸºç¡€ä¸Šï¼Œå°¤å…¶æ˜¯YOLOv5å’ŒYOLOv7çš„æ ¸å¿ƒæ€æƒ³ã€‚è¯¥ç®—æ³•é€šè¿‡å¼•å…¥æ–°çš„æ¶æ„å’Œè®­ç»ƒç­–ç•¥ï¼Œæ—¨åœ¨æå‡ç›®æ ‡æ£€æµ‹çš„ç²¾åº¦å’Œæ•ˆç‡ã€‚YOLOv8çš„è®¾è®¡ç†å¿µå›´ç»•ç€å®æ—¶æ€§å’Œå‡†ç¡®æ€§å±•å¼€ï¼Œé€‚ç”¨äºå„ç§å¤æ‚çš„è§†è§‰ä»»åŠ¡ã€‚

YOLOv8çš„ç½‘ç»œç»“æ„å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šBackboneã€Neckå’ŒHeadã€‚æ¯ä¸ªéƒ¨åˆ†åœ¨æ•´ä½“ç›®æ ‡æ£€æµ‹è¿‡ç¨‹ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚Backboneè´Ÿè´£ç‰¹å¾æå–ï¼ŒNeckåˆ™è´Ÿè´£ç‰¹å¾èåˆï¼Œè€ŒHeadåˆ™è¿›è¡Œæœ€ç»ˆçš„ç›®æ ‡æ£€æµ‹å’Œåˆ†ç±»ã€‚

åœ¨Backboneéƒ¨åˆ†ï¼ŒYOLOv8é‡‡ç”¨äº†ä¸€ç³»åˆ—å·ç§¯å’Œåå·ç§¯å±‚ï¼Œåˆ©ç”¨æ®‹å·®è¿æ¥å’Œç“¶é¢ˆç»“æ„æ¥å‡å°ç½‘ç»œçš„å¤§å°å¹¶æé«˜æ€§èƒ½ã€‚è¯¥éƒ¨åˆ†çš„æ ¸å¿ƒæ¨¡å—æ˜¯C2æ¨¡å—ï¼Œæ„æˆäº†YOLOv8çš„åŸºç¡€ã€‚å…·ä½“è€Œè¨€ï¼ŒBackboneç”±5ä¸ªCBSæ¨¡å—ã€4ä¸ªC2fæ¨¡å—å’Œ1ä¸ªå¿«é€Ÿç©ºé—´é‡‘å­—å¡”æ± åŒ–ï¼ˆSPPFï¼‰æ¨¡å—ç»„æˆã€‚CBSæ¨¡å—é€šè¿‡å·ç§¯ã€å½’ä¸€åŒ–å’ŒSiLUæ¿€æ´»å‡½æ•°çš„ç»„åˆï¼Œæœ‰æ•ˆæå–å›¾åƒä¸­çš„ç‰¹å¾ï¼Œè§£å†³äº†åå‘ä¼ æ’­è¿‡ç¨‹ä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œä»è€Œæå‡äº†æ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦å’Œæ•ˆæœã€‚C2fæ¨¡å—åˆ™åœ¨YOLOv5çš„C3æ¨¡å—åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œé‡‡ç”¨äº†ELANæ€æƒ³ï¼Œå¢å¼ºäº†ç‰¹å¾çš„é‡ç”¨æ€§å’Œæ¢¯åº¦æµåŠ¨æ€§ã€‚C2fæ¨¡å—é€šè¿‡åˆ†æ”¯ç»“æ„ï¼Œå°†ç‰¹å¾å›¾çš„æ·±åº¦ä¿¡æ¯ä¸ç©ºé—´ä¿¡æ¯è¿›è¡Œèåˆï¼Œç¡®ä¿äº†ç‰¹å¾æå–çš„å…¨é¢æ€§å’Œå‡†ç¡®æ€§ã€‚

Neckéƒ¨åˆ†é‡‡ç”¨äº†PAN-FPNï¼ˆPath Aggregation Network - Feature Pyramid Networkï¼‰ç»“æ„ï¼Œæ—¨åœ¨é€šè¿‡å¤šå°ºåº¦ç‰¹å¾èåˆæŠ€æœ¯ï¼Œæå‡ç›®æ ‡æ£€æµ‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚é€šè¿‡å°†æ¥è‡ªBackboneä¸åŒé˜¶æ®µçš„ç‰¹å¾å›¾è¿›è¡Œèåˆï¼ŒYOLOv8èƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰ä¸åŒå°ºåº¦ç›®æ ‡çš„ä¿¡æ¯ã€‚è¿™ç§èåˆç­–ç•¥ä¸ä»…æé«˜äº†æ£€æµ‹ç²¾åº¦ï¼Œè¿˜å¢å¼ºäº†æ¨¡å‹å¯¹å¤æ‚åœºæ™¯çš„é€‚åº”èƒ½åŠ›ã€‚Neckéƒ¨åˆ†çš„è®¾è®¡ä½¿å¾—é«˜å±‚ç‰¹å¾ä¸ä¸­å±‚å’Œæµ…å±‚ç‰¹å¾ä¹‹é—´çš„è¿æ¥æ›´åŠ ç´§å¯†ï¼Œç¡®ä¿äº†ä¿¡æ¯çš„å……åˆ†æµåŠ¨ã€‚

åœ¨Headéƒ¨åˆ†ï¼ŒYOLOv8é‡‡ç”¨äº†ä¸‰ä¸ªè§£è€¦æ£€æµ‹å¤´ï¼Œåˆ†åˆ«è´Ÿè´£ä¸åŒå°ºåº¦ä¸‹çš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚æ¯ä¸ªæ£€æµ‹å¤´éƒ½åŒ…å«ä¸€ç³»åˆ—å·ç§¯å±‚å’Œåå·ç§¯å±‚ï¼Œç”¨äºç”Ÿæˆæœ€ç»ˆçš„æ£€æµ‹ç»“æœã€‚YOLOv8çš„Headéƒ¨åˆ†å€Ÿé‰´äº†YOLOXå’ŒYOLOv6çš„è§£è€¦å¤´è®¾è®¡ï¼Œå–æ¶ˆäº†ä¼ ç»Ÿçš„objectnessåˆ†æ”¯ï¼Œé€šè¿‡è¾¹æ¡†å›å½’å’Œç›®æ ‡åˆ†ç±»çš„ç»„åˆï¼Œæå‡äº†æ£€æµ‹çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚è¯¥éƒ¨åˆ†çš„è¾“å‡ºç‰¹å¾å›¾ç»è¿‡å¤„ç†åï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°è¿›è¡Œç›®æ ‡çš„åˆ†ç±»å’Œå®šä½ã€‚

YOLOv8çš„å¦ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹æ˜¯å…¶æŸå¤±å‡½æ•°çš„è®¾è®¡ã€‚ç®—æ³•é‡‡ç”¨äº†VFLLossä½œä¸ºåˆ†ç±»æŸå¤±ï¼Œå¹¶ç»“åˆDFLLosså’ŒCIoULossæ¥ä¼˜åŒ–è¾¹ç•Œæ¡†çš„å›å½’è¿‡ç¨‹ã€‚è¿™ç§æŸå¤±å‡½æ•°çš„ç»„åˆä¸ä»…æé«˜äº†æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡ï¼Œè¿˜å¢å¼ºäº†å¯¹å°ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨æ ·æœ¬ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ã€‚YOLOv8é€šè¿‡TaskAlignedçš„AssigneråŒ¹é…ç­–ç•¥ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†æ ·æœ¬åŒ¹é…è¿‡ç¨‹ï¼Œä½¿å¾—è®­ç»ƒæ›´åŠ é«˜æ•ˆã€‚

æ­¤å¤–ï¼ŒYOLOv8åœ¨æ•°æ®é¢„å¤„ç†é˜¶æ®µä¹Ÿé‡‡ç”¨äº†YOLOv5çš„ç­–ç•¥ï¼ŒåŒ…æ‹¬é©¬èµ›å…‹å¢å¼ºã€æ··åˆå¢å¼ºã€ç©ºé—´æ‰°åŠ¨å’Œé¢œè‰²æ‰°åŠ¨ç­‰å¤šç§æ•°æ®å¢å¼ºæ‰‹æ®µã€‚è¿™äº›å¢å¼ºç­–ç•¥èƒ½å¤Ÿæœ‰æ•ˆæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œä½¿å…¶åœ¨é¢å¯¹ä¸åŒåœºæ™¯å’Œæ¡ä»¶æ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒè¾ƒé«˜çš„æ£€æµ‹ç²¾åº¦ã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8ç®—æ³•é€šè¿‡ä¸€ç³»åˆ—åˆ›æ–°å’Œä¼˜åŒ–ï¼Œæå‡äº†ç›®æ ‡æ£€æµ‹çš„æ€§èƒ½ã€‚å…¶è½»é‡åŒ–çš„ç‰¹å¾æå–ç½‘ç»œã€æœ‰æ•ˆçš„ç‰¹å¾èåˆç­–ç•¥ä»¥åŠå…ˆè¿›çš„æŸå¤±å‡½æ•°è®¾è®¡ï¼Œä½¿å¾—YOLOv8åœ¨å®æ—¶æ€§å’Œå‡†ç¡®æ€§ä¹‹é—´æ‰¾åˆ°äº†è‰¯å¥½çš„å¹³è¡¡ã€‚ä½œä¸ºYOLOç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼ŒYOLOv8ä¸ä»…ç»§æ‰¿äº†å‰å‡ ä»£ç®—æ³•çš„ä¼˜ç‚¹ï¼Œè¿˜åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†é‡è¦çš„æ”¹è¿›ï¼Œæˆä¸ºç›®æ ‡æ£€æµ‹é¢†åŸŸçš„åˆä¸€é‡è¦é‡Œç¨‹ç¢‘ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\yolo\pose\val.py

ä»¥ä¸‹æ˜¯å¯¹ç»™å®šä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æå’Œè¯¦ç»†æ³¨é‡Šçš„ç»“æœï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license

from pathlib import Path
import numpy as np
import torch
from ultralytics.models.yolo.detect import DetectionValidator
from ultralytics.utils import LOGGER, ops
from ultralytics.utils.metrics import PoseMetrics, box_iou, kpt_iou
from ultralytics.utils.plotting import output_to_target, plot_images

class PoseValidator(DetectionValidator):
    """
    PoseValidatorç±»æ‰©å±•äº†DetectionValidatorç±»ï¼Œç”¨äºåŸºäºå§¿æ€æ¨¡å‹çš„éªŒè¯ã€‚
    """

    def __init__(self, dataloader=None, save_dir=None, pbar=None, args=None, _callbacks=None):
        """åˆå§‹åŒ–PoseValidatorå¯¹è±¡ï¼Œè®¾ç½®è‡ªå®šä¹‰å‚æ•°å’Œå±æ€§ã€‚"""
        super().__init__(dataloader, save_dir, pbar, args, _callbacks)
        self.sigma = None  # ç”¨äºè®¡ç®—å…³é”®ç‚¹çš„æ ‡å‡†å·®
        self.kpt_shape = None  # å…³é”®ç‚¹çš„å½¢çŠ¶
        self.args.task = 'pose'  # è®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºå§¿æ€ä¼°è®¡
        self.metrics = PoseMetrics(save_dir=self.save_dir, on_plot=self.on_plot)  # åˆå§‹åŒ–å§¿æ€åº¦é‡
        if isinstance(self.args.device, str) and self.args.device.lower() == 'mps':
            LOGGER.warning("WARNING âš ï¸ Apple MPS known Pose bug. Recommend 'device=cpu' for Pose models.")

    def preprocess(self, batch):
        """é¢„å¤„ç†æ‰¹æ¬¡æ•°æ®ï¼Œå°†å…³é”®ç‚¹æ•°æ®è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶ç§»åŠ¨åˆ°è®¾å¤‡ä¸Šã€‚"""
        batch = super().preprocess(batch)  # è°ƒç”¨çˆ¶ç±»çš„é¢„å¤„ç†æ–¹æ³•
        batch['keypoints'] = batch['keypoints'].to(self.device).float()  # è½¬æ¢å…³é”®ç‚¹æ•°æ®ç±»å‹
        return batch

    def postprocess(self, preds):
        """åº”ç”¨éæœ€å¤§æŠ‘åˆ¶ï¼Œè¿”å›é«˜ç½®ä¿¡åº¦çš„æ£€æµ‹ç»“æœã€‚"""
        return ops.non_max_suppression(preds,
                                       self.args.conf,
                                       self.args.iou,
                                       labels=self.lb,
                                       multi_label=True,
                                       agnostic=self.args.single_cls,
                                       max_det=self.args.max_det,
                                       nc=self.nc)

    def init_metrics(self, model):
        """åˆå§‹åŒ–YOLOæ¨¡å‹çš„å§¿æ€ä¼°è®¡åº¦é‡ã€‚"""
        super().init_metrics(model)  # è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•
        self.kpt_shape = self.data['kpt_shape']  # è·å–å…³é”®ç‚¹å½¢çŠ¶
        is_pose = self.kpt_shape == [17, 3]  # åˆ¤æ–­æ˜¯å¦ä¸ºå§¿æ€æ¨¡å‹
        nkpt = self.kpt_shape[0]  # å…³é”®ç‚¹æ•°é‡
        self.sigma = OKS_SIGMA if is_pose else np.ones(nkpt) / nkpt  # è®¾ç½®æ ‡å‡†å·®

    def update_metrics(self, preds, batch):
        """æ›´æ–°åº¦é‡æŒ‡æ ‡ã€‚"""
        for si, pred in enumerate(preds):
            idx = batch['batch_idx'] == si  # è·å–å½“å‰æ‰¹æ¬¡çš„ç´¢å¼•
            cls = batch['cls'][idx]  # è·å–å½“å‰æ‰¹æ¬¡çš„ç±»åˆ«
            bbox = batch['bboxes'][idx]  # è·å–å½“å‰æ‰¹æ¬¡çš„è¾¹ç•Œæ¡†
            kpts = batch['keypoints'][idx]  # è·å–å½“å‰æ‰¹æ¬¡çš„å…³é”®ç‚¹
            nl, npr = cls.shape[0], pred.shape[0]  # æ ‡ç­¾æ•°é‡å’Œé¢„æµ‹æ•°é‡
            nk = kpts.shape[1]  # å…³é”®ç‚¹æ•°é‡
            shape = batch['ori_shape'][si]  # åŸå§‹å›¾åƒå½¢çŠ¶
            correct_kpts = torch.zeros(npr, self.niou, dtype=torch.bool, device=self.device)  # åˆå§‹åŒ–æ­£ç¡®å…³é”®ç‚¹
            correct_bboxes = torch.zeros(npr, self.niou, dtype=torch.bool, device=self.device)  # åˆå§‹åŒ–æ­£ç¡®è¾¹ç•Œæ¡†
            self.seen += 1  # å¢åŠ å·²å¤„ç†çš„æ‰¹æ¬¡æ•°

            if npr == 0:  # å¦‚æœæ²¡æœ‰é¢„æµ‹
                if nl:
                    self.stats.append((correct_bboxes, correct_kpts, *torch.zeros((2, 0), device=self.device), cls.squeeze(-1)))
                continue

            # å¤„ç†é¢„æµ‹
            if self.args.single_cls:
                pred[:, 5] = 0  # å¦‚æœæ˜¯å•ç±»ï¼Œè®¾ç½®ç±»åˆ«ä¸º0
            predn = pred.clone()  # å…‹éš†é¢„æµ‹ç»“æœ
            ops.scale_boxes(batch['img'][si].shape[1:], predn[:, :4], shape, ratio_pad=batch['ratio_pad'][si])  # ç¼©æ”¾è¾¹ç•Œæ¡†
            pred_kpts = predn[:, 6:].view(npr, nk, -1)  # é‡å¡‘å…³é”®ç‚¹
            ops.scale_coords(batch['img'][si].shape[1:], pred_kpts, shape, ratio_pad=batch['ratio_pad'][si])  # ç¼©æ”¾å…³é”®ç‚¹åæ ‡

            # è¯„ä¼°
            if nl:
                height, width = batch['img'].shape[2:]  # è·å–å›¾åƒé«˜åº¦å’Œå®½åº¦
                tbox = ops.xywh2xyxy(bbox) * torch.tensor((width, height, width, height), device=self.device)  # ç›®æ ‡è¾¹ç•Œæ¡†
                ops.scale_boxes(batch['img'][si].shape[1:], tbox, shape, ratio_pad=batch['ratio_pad'][si])  # ç¼©æ”¾ç›®æ ‡è¾¹ç•Œæ¡†
                tkpts = kpts.clone()  # å…‹éš†å…³é”®ç‚¹
                tkpts[..., 0] *= width  # ç¼©æ”¾xåæ ‡
                tkpts[..., 1] *= height  # ç¼©æ”¾yåæ ‡
                tkpts = ops.scale_coords(batch['img'][si].shape[1:], tkpts, shape, ratio_pad=batch['ratio_pad'][si])  # ç¼©æ”¾å…³é”®ç‚¹åæ ‡
                labelsn = torch.cat((cls, tbox), 1)  # åˆå¹¶ç±»åˆ«å’Œè¾¹ç•Œæ¡†
                correct_bboxes = self._process_batch(predn[:, :6], labelsn)  # å¤„ç†è¾¹ç•Œæ¡†
                correct_kpts = self._process_batch(predn[:, :6], labelsn, pred_kpts, tkpts)  # å¤„ç†å…³é”®ç‚¹

            # è®°å½•ç»Ÿè®¡ä¿¡æ¯
            self.stats.append((correct_bboxes, correct_kpts, pred[:, 4], pred[:, 5], cls.squeeze(-1)))

    def _process_batch(self, detections, labels, pred_kpts=None, gt_kpts=None):
        """
        è¿”å›æ­£ç¡®çš„é¢„æµ‹çŸ©é˜µã€‚

        å‚æ•°:
            detections (torch.Tensor): å½¢çŠ¶ä¸º[N, 6]çš„æ£€æµ‹å¼ é‡ã€‚
            labels (torch.Tensor): å½¢çŠ¶ä¸º[M, 5]çš„æ ‡ç­¾å¼ é‡ã€‚
            pred_kpts (torch.Tensor, å¯é€‰): å½¢çŠ¶ä¸º[N, 51]çš„é¢„æµ‹å…³é”®ç‚¹å¼ é‡ã€‚
            gt_kpts (torch.Tensor, å¯é€‰): å½¢çŠ¶ä¸º[N, 51]çš„çœŸå®å…³é”®ç‚¹å¼ é‡ã€‚

        è¿”å›:
            torch.Tensor: å½¢çŠ¶ä¸º[N, 10]çš„æ­£ç¡®é¢„æµ‹çŸ©é˜µã€‚
        """
        if pred_kpts is not None and gt_kpts is not None:
            area = ops.xyxy2xywh(labels[:, 1:])[:, 2:].prod(1) * 0.53  # è®¡ç®—é¢ç§¯
            iou = kpt_iou(gt_kpts, pred_kpts, sigma=self.sigma, area=area)  # è®¡ç®—å…³é”®ç‚¹çš„IoU
        else:  # å¤„ç†è¾¹ç•Œæ¡†
            iou = box_iou(labels[:, 1:], detections[:, :4])  # è®¡ç®—è¾¹ç•Œæ¡†çš„IoU

        return self.match_predictions(detections[:, 5], labels[:, 0], iou)  # åŒ¹é…é¢„æµ‹

    def plot_val_samples(self, batch, ni):
        """ç»˜åˆ¶å¹¶ä¿å­˜éªŒè¯é›†æ ·æœ¬åŠå…¶é¢„æµ‹çš„è¾¹ç•Œæ¡†å’Œå…³é”®ç‚¹ã€‚"""
        plot_images(batch['img'],
                    batch['batch_idx'],
                    batch['cls'].squeeze(-1),
                    batch['bboxes'],
                    kpts=batch['keypoints'],
                    paths=batch['im_file'],
                    fname=self.save_dir / f'val_batch{ni}_labels.jpg',
                    names=self.names,
                    on_plot=self.on_plot)

    def plot_predictions(self, batch, preds, ni):
        """ç»˜åˆ¶YOLOæ¨¡å‹çš„é¢„æµ‹ç»“æœã€‚"""
        pred_kpts = torch.cat([p[:, 6:].view(-1, *self.kpt_shape) for p in preds], 0)  # åˆå¹¶æ‰€æœ‰é¢„æµ‹çš„å…³é”®ç‚¹
        plot_images(batch['img'],
                    *output_to_target(preds, max_det=self.args.max_det),
                    kpts=pred_kpts,
                    paths=batch['im_file'],
                    fname=self.save_dir / f'val_batch{ni}_pred.jpg',
                    names=self.names,
                    on_plot=self.on_plot)  # ç»˜åˆ¶é¢„æµ‹ç»“æœ

    def pred_to_json(self, predn, filename):
        """å°†YOLOé¢„æµ‹ç»“æœè½¬æ¢ä¸ºCOCO JSONæ ¼å¼ã€‚"""
        stem = Path(filename).stem
        image_id = int(stem) if stem.isnumeric() else stem  # è·å–å›¾åƒID
        box = ops.xyxy2xywh(predn[:, :4])  # è½¬æ¢ä¸ºxywhæ ¼å¼
        box[:, :2] -= box[:, 2:] / 2  # å°†ä¸­å¿ƒåæ ‡è½¬æ¢ä¸ºå·¦ä¸Šè§’åæ ‡
        for p, b in zip(predn.tolist(), box.tolist()):
            self.jdict.append({
                'image_id': image_id,
                'category_id': self.class_map[int(p[5])],
                'bbox': [round(x, 3) for x in b],
                'keypoints': p[6:],
                'score': round(p[4], 5)})

    def eval_json(self, stats):
        """ä½¿ç”¨COCO JSONæ ¼å¼è¯„ä¼°ç›®æ ‡æ£€æµ‹æ¨¡å‹ã€‚"""
        if self.args.save_json and self.is_coco and len(self.jdict):
            anno_json = self.data['path'] / 'annotations/person_keypoints_val2017.json'  # æ³¨é‡Šæ–‡ä»¶è·¯å¾„
            pred_json = self.save_dir / 'predictions.json'  # é¢„æµ‹ç»“æœæ–‡ä»¶è·¯å¾„
            LOGGER.info(f'\nEvaluating pycocotools mAP using {pred_json} and {anno_json}...')
            try:
                check_requirements('pycocotools>=2.0.6')  # æ£€æŸ¥pycocotoolsçš„ç‰ˆæœ¬
                from pycocotools.coco import COCO  # å¯¼å…¥COCO API
                from pycocotools.cocoeval import COCOeval  # å¯¼å…¥COCOè¯„ä¼°API

                for x in anno_json, pred_json:
                    assert x.is_file(), f'{x} file not found'  # ç¡®ä¿æ–‡ä»¶å­˜åœ¨
                anno = COCO(str(anno_json))  # åˆå§‹åŒ–æ³¨é‡ŠAPI
                pred = anno.loadRes(str(pred_json))  # åˆå§‹åŒ–é¢„æµ‹API
                for i, eval in enumerate([COCOeval(anno, pred, 'bbox'), COCOeval(anno, pred, 'keypoints')]):
                    if self.is_coco:
                        eval.params.imgIds = [int(Path(x).stem) for x in self.dataloader.dataset.im_files]  # è®¾ç½®è¯„ä¼°å›¾åƒID
                    eval.evaluate()  # è¯„ä¼°
                    eval.accumulate()  # ç´¯ç§¯ç»“æœ
                    eval.summarize()  # æ€»ç»“ç»“æœ
                    idx = i * 4 + 2
                    stats[self.metrics.keys[idx + 1]], stats[self.metrics.keys[idx]] = eval.stats[:2]  # æ›´æ–°mAP
            except Exception as e:
                LOGGER.warning(f'pycocotools unable to run: {e}')  # æ•è·å¼‚å¸¸å¹¶è®°å½•è­¦å‘Š
        return stats  # è¿”å›ç»Ÿè®¡ä¿¡æ¯
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†åˆ†æ
1. **PoseValidatorç±»**: è¯¥ç±»ç»§æ‰¿è‡ª`DetectionValidator`ï¼Œç”¨äºå¤„ç†å§¿æ€ä¼°è®¡çš„éªŒè¯ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**: åœ¨åˆå§‹åŒ–ä¸­è®¾ç½®äº†ä¸€äº›é‡è¦çš„å‚æ•°ï¼Œå¦‚`task`ç±»å‹ã€`metrics`ç­‰ï¼Œå¹¶æ£€æŸ¥è®¾å¤‡ç±»å‹ã€‚
3. **é¢„å¤„ç†å’Œåå¤„ç†**: `preprocess`æ–¹æ³•ç”¨äºå¤„ç†è¾“å…¥æ•°æ®ï¼Œ`postprocess`æ–¹æ³•ç”¨äºåº”ç”¨éæœ€å¤§æŠ‘åˆ¶ä»¥è¿‡æ»¤ä½ç½®ä¿¡åº¦çš„æ£€æµ‹ç»“æœã€‚
4. **åº¦é‡æ›´æ–°**: `update_metrics`æ–¹æ³•è´Ÿè´£æ›´æ–°æ£€æµ‹çš„åº¦é‡æŒ‡æ ‡ï¼ŒåŒ…æ‹¬è¾¹ç•Œæ¡†å’Œå…³é”®ç‚¹çš„åŒ¹é…ã€‚
5. **ç»˜å›¾æ–¹æ³•**: `plot_val_samples`å’Œ`plot_predictions`æ–¹æ³•ç”¨äºå¯è§†åŒ–éªŒè¯é›†æ ·æœ¬å’Œæ¨¡å‹é¢„æµ‹ç»“æœã€‚
6. **JSONè½¬æ¢**: `pred_to_json`å’Œ`eval_json`æ–¹æ³•ç”¨äºå°†é¢„æµ‹ç»“æœè½¬æ¢ä¸ºCOCOæ ¼å¼ï¼Œå¹¶è¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚

è¿™äº›æ ¸å¿ƒéƒ¨åˆ†å…±åŒæ„æˆäº†å§¿æ€ä¼°è®¡æ¨¡å‹éªŒè¯çš„ä¸»è¦æµç¨‹ï¼Œæ¶µç›–äº†æ•°æ®å¤„ç†ã€æ¨¡å‹è¯„ä¼°å’Œç»“æœå¯è§†åŒ–ç­‰å…³é”®ç¯èŠ‚ã€‚

è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨äºYOLOv8æ¨¡å‹å§¿æ€ä¼°è®¡çš„éªŒè¯å™¨ç±»`PoseValidator`çš„å®ç°ï¼Œç»§æ‰¿è‡ª`DetectionValidator`ç±»ã€‚è¯¥ç±»ä¸»è¦ç”¨äºåœ¨å§¿æ€ä¼°è®¡ä»»åŠ¡ä¸­è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚ä»£ç ä¸­åŒ…å«äº†å¤šä¸ªæ–¹æ³•å’Œå±æ€§ï¼Œä¸‹é¢æ˜¯å¯¹å…¶åŠŸèƒ½çš„é€æ­¥åˆ†æã€‚

é¦–å…ˆï¼Œç±»çš„æ„é€ å‡½æ•°`__init__`åˆå§‹åŒ–äº†ä¸€äº›åŸºæœ¬å‚æ•°ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½å™¨ã€ä¿å­˜ç›®å½•ã€è¿›åº¦æ¡ã€å‚æ•°å’Œå›è°ƒå‡½æ•°ã€‚å®ƒè¿˜è®¾ç½®äº†ä»»åŠ¡ç±»å‹ä¸ºâ€œposeâ€ï¼Œå¹¶åˆå§‹åŒ–äº†å§¿æ€ä¼°è®¡çš„åº¦é‡æŒ‡æ ‡ã€‚è‹¥è®¾å¤‡ä¸ºAppleçš„MPSï¼Œç³»ç»Ÿä¼šå‘å‡ºè­¦å‘Šï¼Œå»ºè®®ä½¿ç”¨CPUè¿›è¡Œå§¿æ€æ¨¡å‹çš„è®­ç»ƒã€‚

åœ¨`preprocess`æ–¹æ³•ä¸­ï¼Œè¾“å…¥çš„æ‰¹æ¬¡æ•°æ®è¢«å¤„ç†ï¼Œå°†å…³é”®ç‚¹æ•°æ®è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶ç§»åŠ¨åˆ°æŒ‡å®šè®¾å¤‡ä¸Šã€‚`get_desc`æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæè¿°äº†è¯„ä¼°æŒ‡æ ‡çš„æ ¼å¼ã€‚

`postprocess`æ–¹æ³•åº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼Œè¿”å›å…·æœ‰é«˜ç½®ä¿¡åº¦åˆ†æ•°çš„æ£€æµ‹ç»“æœã€‚`init_metrics`æ–¹æ³•åˆå§‹åŒ–å§¿æ€ä¼°è®¡çš„åº¦é‡æŒ‡æ ‡ï¼Œæ£€æŸ¥å…³é”®ç‚¹çš„å½¢çŠ¶å¹¶è®¾ç½®ç›¸åº”çš„sigmaå€¼ã€‚

`update_metrics`æ–¹æ³•ç”¨äºæ›´æ–°æ¨¡å‹çš„è¯„ä¼°æŒ‡æ ‡ã€‚å®ƒå¤„ç†æ¯ä¸ªé¢„æµ‹ç»“æœï¼Œè®¡ç®—æ­£ç¡®çš„å…³é”®ç‚¹å’Œè¾¹ç•Œæ¡†ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°ç»Ÿè®¡ä¿¡æ¯ä¸­ã€‚å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥å°†é¢„æµ‹ç»“æœä¿å­˜ä¸ºJSONæ ¼å¼ã€‚

`_process_batch`æ–¹æ³•ç”¨äºå¤„ç†æ£€æµ‹å’Œæ ‡ç­¾ï¼Œè®¡ç®—IoUï¼ˆäº¤å¹¶æ¯”ï¼‰å¹¶è¿”å›æ­£ç¡®çš„é¢„æµ‹çŸ©é˜µã€‚è¯¥æ–¹æ³•æ”¯æŒå…³é”®ç‚¹å’Œè¾¹ç•Œæ¡†çš„å¤„ç†ã€‚

`plot_val_samples`å’Œ`plot_predictions`æ–¹æ³•ç”¨äºç»˜åˆ¶éªŒè¯é›†æ ·æœ¬å’Œæ¨¡å‹çš„é¢„æµ‹ç»“æœï¼Œä¿å­˜ä¸ºå›¾åƒæ–‡ä»¶ã€‚`pred_to_json`æ–¹æ³•å°†YOLOçš„é¢„æµ‹ç»“æœè½¬æ¢ä¸ºCOCOæ ¼å¼çš„JSONï¼Œä»¥ä¾¿åç»­è¯„ä¼°ã€‚

æœ€åï¼Œ`eval_json`æ–¹æ³•ä½¿ç”¨COCOæ ¼å¼çš„JSONè¯„ä¼°å¯¹è±¡æ£€æµ‹æ¨¡å‹çš„æ€§èƒ½ï¼Œè®¡ç®—mAPï¼ˆå¹³å‡ç²¾åº¦å‡å€¼ï¼‰ç­‰æŒ‡æ ‡ï¼Œå¹¶è¾“å‡ºè¯„ä¼°ç»“æœã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¯¥æ–‡ä»¶å®ç°äº†YOLOv8å§¿æ€ä¼°è®¡æ¨¡å‹çš„éªŒè¯è¿‡ç¨‹ï¼Œæ¶µç›–äº†æ•°æ®é¢„å¤„ç†ã€æŒ‡æ ‡è®¡ç®—ã€ç»“æœå¯è§†åŒ–å’Œè¯„ä¼°ç­‰å¤šä¸ªæ–¹é¢ï¼Œé€‚ç”¨äºå§¿æ€ä¼°è®¡ä»»åŠ¡çš„æ¨¡å‹æ€§èƒ½è¯„ä¼°ã€‚

#### 11.2 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\orepa.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F
import numpy as np

# å®šä¹‰ä¸€ä¸ªåä¸ºOREPAçš„å·ç§¯æ¨¡å—
class OREPA(nn.Module):
    def __init__(self, in_channels, out_channels, kernel_size=3, stride=1, padding=None, groups=1, dilation=1, act=True):
        super(OREPA, self).__init__()
        
        # åˆå§‹åŒ–è¾“å…¥è¾“å‡ºé€šé“ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€å¡«å……ã€åˆ†ç»„å’Œæ‰©å¼ 
        self.in_channels = in_channels
        self.out_channels = out_channels
        self.kernel_size = kernel_size
        self.stride = stride
        self.padding = padding if padding is not None else (kernel_size // 2)
        self.groups = groups
        self.dilation = dilation
        
        # æ¿€æ´»å‡½æ•°çš„é€‰æ‹©
        self.nonlinear = nn.ReLU() if act else nn.Identity()
        
        # å®šä¹‰å·ç§¯å±‚çš„æƒé‡å‚æ•°
        self.weight_orepa_origin = nn.Parameter(torch.Tensor(out_channels, in_channels // groups, kernel_size, kernel_size))
        nn.init.kaiming_uniform_(self.weight_orepa_origin)  # ä½¿ç”¨Heåˆå§‹åŒ–
        
        # å®šä¹‰å…¶ä»–å·ç§¯å±‚çš„æƒé‡å‚æ•°
        self.weight_orepa_avg_conv = nn.Parameter(torch.Tensor(out_channels, in_channels // groups, 1, 1))
        nn.init.kaiming_uniform_(self.weight_orepa_avg_conv)
        
        self.weight_orepa_1x1 = nn.Parameter(torch.Tensor(out_channels, in_channels // groups, 1, 1))
        nn.init.kaiming_uniform_(self.weight_orepa_1x1)

        # å…¶ä»–åˆå§‹åŒ–ä»£ç çœç•¥...

    def weight_gen(self):
        # ç”Ÿæˆæœ€ç»ˆçš„å·ç§¯æƒé‡
        weight_orepa_origin = self.weight_orepa_origin  # åŸå§‹å·ç§¯æƒé‡
        weight_orepa_avg = self.weight_orepa_avg_conv  # å¹³å‡å·ç§¯æƒé‡
        weight_orepa_1x1 = self.weight_orepa_1x1  # 1x1å·ç§¯æƒé‡
        
        # å°†æ‰€æœ‰æƒé‡ç»“åˆ
        weight = weight_orepa_origin + weight_orepa_avg + weight_orepa_1x1
        return weight

    def forward(self, inputs):
        # å‰å‘ä¼ æ’­
        weight = self.weight_gen()  # ç”Ÿæˆæƒé‡
        out = F.conv2d(inputs, weight, stride=self.stride, padding=self.padding, dilation=self.dilation, groups=self.groups)  # å·ç§¯æ“ä½œ
        return self.nonlinear(out)  # æ¿€æ´»å‡½æ•°

# å…¶ä»–ç±»çš„å®šä¹‰çœç•¥...
```

### ä»£ç è¯´æ˜ï¼š
1. **OREPAç±»**ï¼šè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å·ç§¯æ¨¡å—ï¼Œç»§æ‰¿è‡ª`nn.Module`ã€‚å®ƒåŒ…å«å¤šä¸ªå·ç§¯å±‚çš„æƒé‡å‚æ•°ï¼Œä½¿ç”¨ä¸åŒçš„åˆå§‹åŒ–æ–¹æ³•ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**ï¼šåœ¨`__init__`ä¸­ï¼Œå®šä¹‰äº†è¾“å…¥è¾“å‡ºé€šé“ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€å¡«å……ã€åˆ†ç»„å’Œæ‰©å¼ ç­‰å‚æ•°ï¼Œå¹¶åˆå§‹åŒ–å·ç§¯å±‚çš„æƒé‡ã€‚
3. **æƒé‡ç”Ÿæˆ**ï¼š`weight_gen`æ–¹æ³•ç”¨äºç”Ÿæˆæœ€ç»ˆçš„å·ç§¯æƒé‡ï¼Œå°†ä¸åŒæ¥æºçš„æƒé‡ç»“åˆèµ·æ¥ã€‚
4. **å‰å‘ä¼ æ’­**ï¼š`forward`æ–¹æ³•å®ç°äº†å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œè°ƒç”¨ç”Ÿæˆçš„æƒé‡è¿›è¡Œå·ç§¯æ“ä½œï¼Œå¹¶åº”ç”¨æ¿€æ´»å‡½æ•°ã€‚

ä»¥ä¸Šæ˜¯ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†åŠå…¶è¯¦ç»†æ³¨é‡Šï¼Œå¸®åŠ©ç†è§£è¯¥æ¨¡å—çš„ç»“æ„å’ŒåŠŸèƒ½ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶åŒ…å«äº†å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œä¸»è¦ç”¨äºå®ç°ä¸€ç§åä¸ºOREPAï¼ˆOptimized Reparameterization for Efficient Convolutionï¼‰çš„å·ç§¯æ¨¡å—ï¼Œæ—¨åœ¨æé«˜å·ç§¯ç¥ç»ç½‘ç»œçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è¯´æ˜ã€‚

é¦–å…ˆï¼Œå¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬PyTorchçš„æ ¸å¿ƒåº“ã€æ•°å­¦åº“ã€NumPyä»¥åŠä¸€äº›è‡ªå®šä¹‰çš„æ¨¡å—ã€‚`transI_fusebn`å’Œ`transVI_multiscale`æ˜¯ä¸¤ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå‰è€…ç”¨äºå°†å·ç§¯æ ¸å’Œæ‰¹å½’ä¸€åŒ–å±‚çš„å‚æ•°èåˆï¼Œåè€…ç”¨äºå¯¹å·ç§¯æ ¸è¿›è¡Œå¤šå°ºåº¦å¡«å……ã€‚

`OREPA`ç±»æ˜¯æ ¸å¿ƒç±»ä¹‹ä¸€ï¼Œç»§æ‰¿è‡ª`nn.Module`ã€‚åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå®šä¹‰äº†è¾“å…¥å’Œè¾“å‡ºé€šé“ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€å¡«å……ã€åˆ†ç»„ã€æ‰©å¼ ç­‰å‚æ•°ã€‚æ ¹æ®æ˜¯å¦å¤„äºéƒ¨ç½²æ¨¡å¼ï¼Œåˆå§‹åŒ–ä¸åŒçš„å·ç§¯å±‚å’Œå‚æ•°ã€‚è¯¥ç±»çš„è®¾è®¡å…è®¸é€šè¿‡ä¸åŒçš„åˆ†æ”¯ç»„åˆç”Ÿæˆå·ç§¯æƒé‡ï¼Œåˆ©ç”¨äº†å¤šä¸ªå·ç§¯æ ¸å’Œæ‰¹å½’ä¸€åŒ–çš„ç»„åˆï¼Œä»¥æé«˜æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚

`weight_gen`æ–¹æ³•ç”¨äºç”Ÿæˆæœ€ç»ˆçš„å·ç§¯æƒé‡ï¼Œé€šè¿‡å¯¹ä¸åŒåˆ†æ”¯çš„æƒé‡è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œå½¢æˆæœ€ç»ˆçš„å·ç§¯æ ¸ã€‚`forward`æ–¹æ³•å®ç°äº†å‰å‘ä¼ æ’­ï¼Œè®¡ç®—è¾“å…¥æ•°æ®çš„å·ç§¯ç»“æœï¼Œå¹¶é€šè¿‡éçº¿æ€§æ¿€æ´»å‡½æ•°å’Œæ‰¹å½’ä¸€åŒ–å±‚è¿›è¡Œå¤„ç†ã€‚

`OREPA_LargeConv`ç±»å®ç°äº†ä¸€ä¸ªå¤§å‹å·ç§¯æ¨¡å—ï¼Œæ”¯æŒæ›´å¤§çš„å·ç§¯æ ¸ã€‚å®ƒçš„ç»“æ„ä¸`OREPA`ç±»ä¼¼ï¼Œä½†å¢åŠ äº†å¤šä¸ªå·ç§¯å±‚çš„ç»„åˆï¼Œèƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„ç‰¹å¾æå–ä»»åŠ¡ã€‚

`ConvBN`ç±»åˆ™æ˜¯ä¸€ä¸ªç®€å•çš„å·ç§¯åŠ æ‰¹å½’ä¸€åŒ–æ¨¡å—ï¼Œæ”¯æŒåœ¨éƒ¨ç½²æ¨¡å¼ä¸‹ç›´æ¥ä½¿ç”¨èåˆåçš„å·ç§¯æ ¸ã€‚

`OREPA_3x3_RepVGG`ç±»æ˜¯ä¸€ä¸ªç‰¹å®šçš„OREPAæ¨¡å—ï¼Œä¸“é—¨ç”¨äº3x3å·ç§¯æ ¸çš„æƒ…å†µï¼Œæ”¯æŒä¸åŒçš„åˆ†æ”¯ç»„åˆä»¥ç”Ÿæˆå·ç§¯æƒé‡ã€‚

æœ€åï¼Œ`RepVGGBlock_OREPA`ç±»å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„å—ç»“æ„ï¼Œç»“åˆäº†OREPAæ¨¡å—å’Œ1x1å·ç§¯å±‚ï¼Œèƒ½å¤Ÿå¤„ç†è¾“å…¥æ•°æ®å¹¶è¾“å‡ºç‰¹å¾å›¾ã€‚è¯¥ç±»è¿˜æ”¯æŒSEï¼ˆSqueeze-and-Excitationï¼‰æ³¨æ„åŠ›æœºåˆ¶çš„é›†æˆï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ç§é«˜æ•ˆçš„å·ç§¯ç¥ç»ç½‘ç»œæ¨¡å—ï¼Œèƒ½å¤Ÿé€šè¿‡ä¸åŒçš„å‚æ•°ç»„åˆå’Œç»“æ„è®¾è®¡ï¼Œæå‡æ¨¡å‹çš„æ€§èƒ½å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºå„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡ã€‚

#### 11.3 ui.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ streamlit è¿è¡ŒæŒ‡å®šçš„è„šæœ¬
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤
    result = subprocess.run(command, shell=True)
    # æ£€æŸ¥å‘½ä»¤æ‰§è¡Œçš„è¿”å›ç ï¼Œå¦‚æœä¸ä¸º0ï¼Œè¡¨ç¤ºæ‰§è¡Œå‡ºé”™
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")

# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # å‡è®¾è„šæœ¬åœ¨å½“å‰ç›®å½•ä¸‹

    # è°ƒç”¨å‡½æ•°è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼š
   - `sys`ï¼šç”¨äºè®¿é—®ä¸ Python è§£é‡Šå™¨ç´§å¯†ç›¸å…³çš„å˜é‡å’Œå‡½æ•°ã€‚
   - `subprocess`ï¼šç”¨äºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤å’Œä¸å…¶äº¤äº’ã€‚

2. **`run_script` å‡½æ•°**ï¼š
   - å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•° `script_path`ï¼Œè¡¨ç¤ºè¦è¿è¡Œçš„ Python è„šæœ¬çš„è·¯å¾„ã€‚
   - ä½¿ç”¨ `sys.executable` è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ç¯å¢ƒæ¥è¿è¡Œè„šæœ¬ã€‚
   - æ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œæ„å»ºçš„å‘½ä»¤ï¼Œå¹¶é€šè¿‡ `shell=True` å…è®¸åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤ã€‚
   - æ£€æŸ¥å‘½ä»¤çš„è¿”å›ç ï¼Œå¦‚æœè¿”å›ç ä¸ä¸º0ï¼Œè¡¨ç¤ºæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

3. **ä¸»ç¨‹åºå—**ï¼š
   - åœ¨ `if __name__ == "__main__":` å—ä¸­ï¼Œç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥è„šæœ¬æ—¶æ‰ä¼šæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚
   - æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ä¸º `web.py`ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¯¥è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶åä¸º `ui.py`ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡å½“å‰çš„ Python ç¯å¢ƒè¿è¡Œä¸€ä¸ªæŒ‡å®šçš„è„šæœ¬ï¼Œå…·ä½“æ˜¯ä¸€ä¸ªåä¸º `web.py` çš„æ–‡ä»¶ã€‚ç¨‹åºé¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œä»¥åŠä¸€ä¸ªè‡ªå®šä¹‰çš„è·¯å¾„å¤„ç†æ¨¡å— `abs_path`ã€‚

åœ¨ `run_script` å‡½æ•°ä¸­ï¼Œç¨‹åºæ¥å—ä¸€ä¸ªå‚æ•° `script_path`ï¼Œè¯¥å‚æ•°æ˜¯è¦è¿è¡Œçš„è„šæœ¬çš„è·¯å¾„ã€‚å‡½æ•°é¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™é€šè¿‡ `sys.executable` å®ç°ã€‚æ¥ç€ï¼Œç¨‹åºæ„å»ºäº†ä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œè¯¥å‘½ä»¤ç”¨äºè¿è¡Œ `streamlit`ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ•°æ®åº”ç”¨çš„åº“ã€‚å‘½ä»¤çš„æ ¼å¼æ˜¯å°† Python è§£é‡Šå™¨ä¸ `-m streamlit run` ç»“åˆä½¿ç”¨ï¼Œå¹¶ä¼ å…¥è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ã€‚

éšåï¼Œç¨‹åºä½¿ç”¨ `subprocess.run` æ–¹æ³•æ‰§è¡Œæ„å»ºå¥½çš„å‘½ä»¤ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ–°çš„å­è¿›ç¨‹ä¸­è¿è¡Œå‘½ä»¤ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œçš„è¿”å›ç ä¸ä¸ºé›¶ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œç¨‹åºä¼šè¾“å‡ºä¸€æ¡é”™è¯¯ä¿¡æ¯ã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œç¨‹åºé€šè¿‡ `if __name__ == "__main__":` è¯­å¥æ¥ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥æ–‡ä»¶æ—¶æ‰ä¼šæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚å®ƒæŒ‡å®šäº†è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ä¸º `web.py`ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºçš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£æ¥è¿è¡Œä¸€ä¸ªç‰¹å®šçš„ Python è„šæœ¬ï¼Œå¹¶åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¤„ç†å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚

#### 11.4 train.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import random
import numpy as np
import torch.nn as nn
from ultralytics.data import build_dataloader, build_yolo_dataset
from ultralytics.engine.trainer import BaseTrainer
from ultralytics.models import yolo
from ultralytics.nn.tasks import DetectionModel
from ultralytics.utils import LOGGER, RANK
from ultralytics.utils.torch_utils import de_parallel, torch_distributed_zero_first

class DetectionTrainer(BaseTrainer):
    """
    æ‰©å±•è‡ª BaseTrainer ç±»ï¼Œç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»º YOLO æ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ä¸º `train` æˆ– `val`ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œä»…ç”¨äº `rect` æ¨¡å¼ã€‚é»˜è®¤ä¸º Noneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)  # è·å–æ¨¡å‹çš„æœ€å¤§æ­¥å¹…
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]  # ç¡®ä¿æ¨¡å¼æœ‰æ•ˆ
        with torch_distributed_zero_first(rank):  # ä»…åœ¨ DDP æ—¶åˆå§‹åŒ–æ•°æ®é›† *.cache ä¸€æ¬¡
            dataset = self.build_dataset(dataset_path, mode, batch_size)  # æ„å»ºæ•°æ®é›†
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        workers = self.args.workers if mode == "train" else self.args.workers * 2  # æ ¹æ®æ¨¡å¼è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹ä¸€æ‰¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å½’ä¸€åŒ–
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©å›¾åƒå¤§å°
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è¿›è¡Œæ’å€¼ç¼©æ”¾
            batch["img"] = imgs  # æ›´æ–°å›¾åƒ
        return batch

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å› YOLO æ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )

    def plot_metrics(self):
        """ä» CSV æ–‡ä»¶ä¸­ç»˜åˆ¶æŒ‡æ ‡ã€‚"""
        plot_results(file=self.csv, on_plot=self.on_plot)  # ä¿å­˜ç»“æœå›¾
```

### ä»£ç è¯´æ˜ï¼š
1. **DetectionTrainer ç±»**ï¼šç»§æ‰¿è‡ª `BaseTrainer`ï¼Œç”¨äºå®ç° YOLO æ¨¡å‹çš„è®­ç»ƒã€‚
2. **build_dataset æ–¹æ³•**ï¼šæ ¹æ®ç»™å®šçš„å›¾åƒè·¯å¾„å’Œæ¨¡å¼æ„å»ºæ•°æ®é›†ï¼Œæ”¯æŒè®­ç»ƒå’ŒéªŒè¯æ¨¡å¼ã€‚
3. **get_dataloader æ–¹æ³•**ï¼šæ„é€ æ•°æ®åŠ è½½å™¨ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒæ—¶åªåˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†ã€‚
4. **preprocess_batch æ–¹æ³•**ï¼šå¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å½’ä¸€åŒ–å’Œå¤šå°ºåº¦è°ƒæ•´ã€‚
5. **get_model æ–¹æ³•**ï¼šè¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹ï¼Œå¯ä»¥é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
6. **plot_training_samples æ–¹æ³•**ï¼šç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ³¨é‡Šï¼Œä¾¿äºå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ã€‚
7. **plot_metrics æ–¹æ³•**ï¼šä» CSV æ–‡ä»¶ä¸­ç»˜åˆ¶è®­ç»ƒæŒ‡æ ‡ï¼Œä¾¿äºç›‘æ§è®­ç»ƒæ•ˆæœã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è„šæœ¬ï¼Œä¸»è¦åŸºäº YOLOï¼ˆYou Only Look Onceï¼‰æ¶æ„ã€‚å®ƒç»§æ‰¿è‡ª `BaseTrainer` ç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ„å»ºæ•°æ®é›†ã€åŠ è½½æ•°æ®ã€é¢„å¤„ç†å›¾åƒã€è®¾ç½®æ¨¡å‹å±æ€§ã€è·å–æ¨¡å‹ã€éªŒè¯æ¨¡å‹ã€è®°å½•æŸå¤±ã€æ˜¾ç¤ºè®­ç»ƒè¿›åº¦ä»¥åŠç»˜åˆ¶è®­ç»ƒæ ·æœ¬å’ŒæŒ‡æ ‡ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ·±åº¦å­¦ä¹ ç›¸å…³çš„åº“ï¼ˆå¦‚ PyTorchï¼‰ï¼Œä»¥åŠä¸€äº›æ¥è‡ª `ultralytics` çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—æä¾›äº†æ•°æ®å¤„ç†ã€æ¨¡å‹æ„å»ºå’Œè®­ç»ƒçš„åŠŸèƒ½ã€‚

`DetectionTrainer` ç±»æ˜¯è¯¥æ–‡ä»¶çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç®¡ç†è®­ç»ƒè¿‡ç¨‹ã€‚å®ƒåŒ…å«å¤šä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ `build_dataset` æ–¹æ³•ç”¨äºæ„å»º YOLO æ•°æ®é›†ï¼Œæ”¯æŒè®­ç»ƒå’ŒéªŒè¯æ¨¡å¼ï¼Œå¹¶å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ä¸åŒçš„å¢å¼ºæ–¹å¼ã€‚`get_dataloader` æ–¹æ³•åˆ™æ„å»ºå¹¶è¿”å›æ•°æ®åŠ è½½å™¨ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒæ—¶åªåˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†ï¼Œå¹¶æ ¹æ®æ¨¡å¼é€‰æ‹©æ˜¯å¦æ‰“ä¹±æ•°æ®ã€‚

åœ¨å›¾åƒé¢„å¤„ç†æ–¹é¢ï¼Œ`preprocess_batch` æ–¹æ³•è´Ÿè´£å°†å›¾åƒç¼©æ”¾å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ï¼Œæ”¯æŒå¤šå°ºåº¦è®­ç»ƒï¼Œç¡®ä¿è¾“å…¥å›¾åƒçš„å°ºå¯¸é€‚åˆæ¨¡å‹ã€‚`set_model_attributes` æ–¹æ³•åˆ™ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼Œå¦‚ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ã€‚

`get_model` æ–¹æ³•è¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚`get_validator` æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºæ¨¡å‹éªŒè¯çš„å¯¹è±¡ï¼Œå¸®åŠ©è¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œ`label_loss_items` æ–¹æ³•ç”¨äºè¿”å›å¸¦æ ‡ç­¾çš„æŸå¤±å­—å…¸ï¼Œ`progress_string` æ–¹æ³•æ ¼å¼åŒ–è®­ç»ƒè¿›åº¦ä¿¡æ¯ï¼Œä¾¿äºç›‘æ§è®­ç»ƒçŠ¶æ€ã€‚`plot_training_samples` å’Œ `plot_training_labels` æ–¹æ³•åˆ™ç”¨äºå¯è§†åŒ–è®­ç»ƒæ ·æœ¬åŠå…¶æ ‡æ³¨ï¼Œå¸®åŠ©ç”¨æˆ·ç›´è§‚äº†è§£è®­ç»ƒæ•°æ®çš„æƒ…å†µã€‚

æœ€åï¼Œ`plot_metrics` æ–¹æ³•ä» CSV æ–‡ä»¶ä¸­ç»˜åˆ¶è®­ç»ƒæŒ‡æ ‡ï¼Œæä¾›äº†è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ€§èƒ½åé¦ˆã€‚æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹è®­ç»ƒæ¡†æ¶ï¼Œæ¶µç›–äº†æ•°æ®å¤„ç†ã€æ¨¡å‹è®­ç»ƒå’Œç»“æœå¯è§†åŒ–ç­‰å¤šä¸ªæ–¹é¢ã€‚

#### 11.5 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\backbone\repvit.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch.nn as nn
import torch

class Conv2d_BN(torch.nn.Sequential):
    """
    å®šä¹‰ä¸€ä¸ªåŒ…å«å·ç§¯å±‚å’Œæ‰¹å½’ä¸€åŒ–å±‚çš„æ¨¡å—
    """
    def __init__(self, a, b, ks=1, stride=1, pad=0, dilation=1,
                 groups=1, bn_weight_init=1):
        super().__init__()
        # æ·»åŠ å·ç§¯å±‚
        self.add_module('c', torch.nn.Conv2d(
            a, b, ks, stride, pad, dilation, groups, bias=False))
        # æ·»åŠ æ‰¹å½’ä¸€åŒ–å±‚
        self.add_module('bn', torch.nn.BatchNorm2d(b))
        # åˆå§‹åŒ–æ‰¹å½’ä¸€åŒ–å±‚çš„æƒé‡
        torch.nn.init.constant_(self.bn.weight, bn_weight_init)
        torch.nn.init.constant_(self.bn.bias, 0)

    @torch.no_grad()
    def fuse_self(self):
        """
        å°†å·ç§¯å±‚å’Œæ‰¹å½’ä¸€åŒ–å±‚èåˆä¸ºä¸€ä¸ªå·ç§¯å±‚
        """
        c, bn = self._modules.values()  # è·å–å·ç§¯å±‚å’Œæ‰¹å½’ä¸€åŒ–å±‚
        # è®¡ç®—èåˆåçš„æƒé‡å’Œåç½®
        w = bn.weight / (bn.running_var + bn.eps)**0.5
        w = c.weight * w[:, None, None, None]
        b = bn.bias - bn.running_mean * bn.weight / (bn.running_var + bn.eps)**0.5
        # åˆ›å»ºæ–°çš„å·ç§¯å±‚
        m = torch.nn.Conv2d(w.size(1) * self.c.groups, w.size(0), w.shape[2:], 
                             stride=self.c.stride, padding=self.c.padding, 
                             dilation=self.c.dilation, groups=self.c.groups,
                             device=c.weight.device)
        m.weight.data.copy_(w)  # å¤åˆ¶æƒé‡
        m.bias.data.copy_(b)    # å¤åˆ¶åç½®
        return m  # è¿”å›èåˆåçš„å·ç§¯å±‚

class RepViTBlock(nn.Module):
    """
    å®šä¹‰RepViTçš„åŸºæœ¬å—
    """
    def __init__(self, inp, hidden_dim, oup, kernel_size, stride, use_se, use_hs):
        super(RepViTBlock, self).__init__()
        assert stride in [1, 2]  # ç¡®ä¿æ­¥å¹…ä¸º1æˆ–2
        self.identity = stride == 1 and inp == oup  # åˆ¤æ–­æ˜¯å¦éœ€è¦è·³è·ƒè¿æ¥
        assert(hidden_dim == 2 * inp)  # éšè—å±‚ç»´åº¦ä¸ºè¾“å…¥ç»´åº¦çš„ä¸¤å€

        if stride == 2:
            # å¦‚æœæ­¥å¹…ä¸º2ï¼Œå®šä¹‰tokenæ··åˆå’Œé€šé“æ··åˆ
            self.token_mixer = nn.Sequential(
                Conv2d_BN(inp, inp, kernel_size, stride, (kernel_size - 1) // 2, groups=inp),
                nn.Identity() if not use_se else SqueezeExcite(inp, 0.25),
                Conv2d_BN(inp, oup, ks=1, stride=1, pad=0)
            )
            self.channel_mixer = nn.Sequential(
                Conv2d_BN(oup, 2 * oup, 1, 1, 0),
                nn.GELU() if use_hs else nn.GELU(),
                Conv2d_BN(2 * oup, oup, 1, 1, 0, bn_weight_init=0),
            )
        else:
            assert(self.identity)  # å¦‚æœæ­¥å¹…ä¸º1ï¼Œç¡®ä¿è¾“å…¥å’Œè¾“å‡ºé€šé“ç›¸åŒ
            self.token_mixer = nn.Sequential(
                Conv2d_BN(inp, inp, 3, 1, 1, groups=inp),
                nn.Identity() if not use_se else SqueezeExcite(inp, 0.25),
            )
            self.channel_mixer = nn.Sequential(
                Conv2d_BN(inp, hidden_dim, 1, 1, 0),
                nn.GELU() if use_hs else nn.GELU(),
                Conv2d_BN(hidden_dim, oup, 1, 1, 0, bn_weight_init=0),
            )

    def forward(self, x):
        """
        å‰å‘ä¼ æ’­
        """
        return self.channel_mixer(self.token_mixer(x))  # å…ˆè¿›è¡Œtokenæ··åˆï¼Œå†è¿›è¡Œé€šé“æ··åˆ

class RepViT(nn.Module):
    """
    å®šä¹‰RepViTæ¨¡å‹
    """
    def __init__(self, cfgs):
        super(RepViT, self).__init__()
        self.cfgs = cfgs  # é…ç½®åå‘æ®‹å·®å—
        input_channel = self.cfgs[0][2]  # è·å–è¾“å…¥é€šé“æ•°
        # æ„å»ºç¬¬ä¸€ä¸ªå±‚
        patch_embed = nn.Sequential(
            Conv2d_BN(3, input_channel // 2, 3, 2, 1), 
            nn.GELU(),
            Conv2d_BN(input_channel // 2, input_channel, 3, 2, 1)
        )
        layers = [patch_embed]  # å­˜å‚¨æ‰€æœ‰å±‚
        # æ„å»ºåå‘æ®‹å·®å—
        for k, t, c, use_se, use_hs, s in self.cfgs:
            output_channel = _make_divisible(c, 8)  # ç¡®ä¿è¾“å‡ºé€šé“æ•°å¯è¢«8æ•´é™¤
            exp_size = _make_divisible(input_channel * t, 8)  # ç¡®ä¿æ‰©å±•é€šé“æ•°å¯è¢«8æ•´é™¤
            layers.append(RepViTBlock(input_channel, exp_size, output_channel, k, s, use_se, use_hs))
            input_channel = output_channel  # æ›´æ–°è¾“å…¥é€šé“æ•°
        self.features = nn.ModuleList(layers)  # å°†æ‰€æœ‰å±‚å­˜å‚¨ä¸ºModuleList

    def forward(self, x):
        """
        å‰å‘ä¼ æ’­
        """
        features = [None, None, None, None]  # å­˜å‚¨ç‰¹å¾å›¾
        for f in self.features:
            x = f(x)  # é€šè¿‡æ¯ä¸€å±‚
            # æ ¹æ®è¾“å…¥å¤§å°è®°å½•ç‰¹å¾å›¾
            if x.size(2) in [x.size(2) // 4, x.size(2) // 8, x.size(2) // 16, x.size(2) // 32]:
                features[x.size(2) // x.size(2)] = x
        return features  # è¿”å›ç‰¹å¾å›¾

def repvit_m0_9(weights=''):
    """
    æ„å»ºRepViTæ¨¡å‹çš„ä¸€ä¸ªå˜ä½“
    """
    cfgs = [
        # k, t, c, SE, HS, s 
        [3, 2, 48, 1, 0, 1],
        # å…¶ä»–é…ç½®...
    ]
    model = RepViT(cfgs)  # åˆ›å»ºæ¨¡å‹
    if weights:
        model.load_state_dict(update_weight(model.state_dict(), torch.load(weights)['model']))  # åŠ è½½æƒé‡
    return model  # è¿”å›æ¨¡å‹
```

### ä»£ç è¯´æ˜ï¼š
1. **Conv2d_BNç±»**ï¼šå®šä¹‰äº†ä¸€ä¸ªåŒ…å«å·ç§¯å±‚å’Œæ‰¹å½’ä¸€åŒ–å±‚çš„ç»„åˆï¼Œæä¾›äº†èåˆåŠŸèƒ½ä»¥æé«˜æ¨ç†é€Ÿåº¦ã€‚
2. **RepViTBlockç±»**ï¼šå®ç°äº†RepViTçš„åŸºæœ¬å—ï¼Œæ”¯æŒä¸åŒçš„æ­¥å¹…å’Œé€šé“æ··åˆæ–¹å¼ã€‚
3. **RepViTç±»**ï¼šæ„å»ºäº†æ•´ä¸ªRepViTæ¨¡å‹ï¼Œä½¿ç”¨é…ç½®å‚æ•°æ¥å®šä¹‰å„ä¸ªå±‚çš„ç»“æ„ã€‚
4. **repvit_m0_9å‡½æ•°**ï¼šç”¨äºåˆ›å»ºRepViTæ¨¡å‹çš„ç‰¹å®šå˜ä½“ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚

è¿™äº›æ ¸å¿ƒéƒ¨åˆ†æ˜¯æ„å»ºRepViTæ¨¡å‹çš„åŸºç¡€ï¼Œè´Ÿè´£å®šä¹‰ç½‘ç»œç»“æ„å’Œå‰å‘ä¼ æ’­è¿‡ç¨‹ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåŸºäºRepVGGæ¶æ„çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸»è¦ç”¨äºè®¡ç®—æœºè§†è§‰ä»»åŠ¡ã€‚æ–‡ä»¶ä¸­åŒ…å«äº†å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œæ„å»ºäº†ä¸€ä¸ªå¯é…ç½®çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œå…·ä½“å®ç°äº†RepViTï¼ˆä»£è¡¨æ€§è§†è§‰å˜æ¢å™¨ï¼‰æ¨¡å‹ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¼•å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬PyTorchå’Œä¸€äº›ç”¨äºæ„å»ºæ¨¡å‹çš„æ¨¡å—ã€‚`__all__`å®šä¹‰äº†å¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨çš„æ¨¡å‹ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ä¸åŒçš„RepViTæ¨¡å‹ã€‚

`replace_batchnorm`å‡½æ•°ç”¨äºæ›¿æ¢ç½‘ç»œä¸­çš„BatchNormå±‚ï¼Œå°†å…¶è½¬æ¢ä¸ºIdentityå±‚ï¼Œä»¥ä¾¿åœ¨æ¨ç†æ—¶åŠ é€Ÿè®¡ç®—ã€‚`_make_divisible`å‡½æ•°ç¡®ä¿ç½‘ç»œä¸­æ‰€æœ‰å±‚çš„é€šé“æ•°éƒ½æ˜¯8çš„å€æ•°ï¼Œè¿™æ˜¯ä¸ºäº†å…¼å®¹æŸäº›ç¡¬ä»¶åŠ é€Ÿå™¨çš„è¦æ±‚ã€‚

`Conv2d_BN`ç±»æ˜¯ä¸€ä¸ªç»„åˆæ¨¡å—ï¼ŒåŒ…å«å·ç§¯å±‚å’ŒBatchNormå±‚ï¼Œå¹¶åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®äº†BatchNormçš„æƒé‡å’Œåç½®ã€‚å®ƒè¿˜å®ç°äº†`fuse_self`æ–¹æ³•ï¼Œç”¨äºå°†å·ç§¯å’ŒBatchNormå±‚èåˆä¸ºä¸€ä¸ªå·ç§¯å±‚ï¼Œä»¥æé«˜æ¨ç†é€Ÿåº¦ã€‚

`Residual`ç±»å®ç°äº†æ®‹å·®è¿æ¥ï¼Œå…è®¸åœ¨è®­ç»ƒæ—¶éšæœºä¸¢å¼ƒä¸€äº›è¾“å…¥ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚å®ƒåŒæ ·æ”¯æŒå±‚çš„èåˆã€‚

`RepVGGDW`ç±»å®ç°äº†ä¸€ä¸ªæ·±åº¦å¯åˆ†ç¦»å·ç§¯æ¨¡å—ï¼Œç»“åˆäº†å·ç§¯å’ŒBatchNormï¼Œå¹¶æ”¯æŒèåˆæ“ä½œã€‚

`RepViTBlock`ç±»æ˜¯RepViTæ¨¡å‹çš„åŸºæœ¬æ„å»ºå—ï¼ŒåŒ…å«äº†é€šé“æ··åˆå’Œä»¤ç‰Œæ··åˆçš„æ“ä½œã€‚æ ¹æ®æ­¥å¹…çš„ä¸åŒï¼Œæ„å»ºäº†ä¸åŒçš„ç½‘ç»œç»“æ„ã€‚

`RepViT`ç±»æ˜¯æ•´ä¸ªæ¨¡å‹çš„ä¸»ä½“ï¼Œæ¥æ”¶é…ç½®å‚æ•°å¹¶æ„å»ºç½‘ç»œã€‚å®ƒçš„`forward`æ–¹æ³•å®šä¹‰äº†å‰å‘ä¼ æ’­çš„è¿‡ç¨‹ï¼Œå¹¶åœ¨è¾“å…¥å°ºå¯¸å˜åŒ–æ—¶æå–ç‰¹å¾ã€‚

`update_weight`å‡½æ•°ç”¨äºæ›´æ–°æ¨¡å‹çš„æƒé‡ï¼Œå°†é¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡åŠ è½½åˆ°å½“å‰æ¨¡å‹ä¸­ã€‚

æœ€åï¼Œå®šä¹‰äº†å¤šä¸ªæ¨¡å‹æ„é€ å‡½æ•°ï¼Œå¦‚`repvit_m0_9`ã€`repvit_m1_0`ç­‰ï¼Œè¿™äº›å‡½æ•°æ ¹æ®ä¸åŒçš„é…ç½®å‚æ•°æ„å»ºä¸åŒç‰ˆæœ¬çš„RepViTæ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©æ€§åœ°åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œåˆ›å»ºäº†ä¸€ä¸ªRepViTæ¨¡å‹å®ä¾‹ï¼Œå¹¶å¯¹éšæœºè¾“å…¥è¿›è¡Œäº†å‰å‘ä¼ æ’­ï¼Œè¾“å‡ºäº†å„å±‚çš„ç‰¹å¾å›¾å°ºå¯¸ã€‚

æ•´ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„è§†è§‰æ¨¡å‹ï¼Œé€‚ç”¨äºå„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡ï¼Œå¹¶æä¾›äº†è‰¯å¥½çš„æ‰©å±•æ€§å’Œå¯é…ç½®æ€§ã€‚

#### 11.6 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\ops_dcnv3\functions\dcnv3_func.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å¹¶æ·»åŠ è¯¦ç»†ä¸­æ–‡æ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import torch
import torch.nn.functional as F
from torch.autograd import Function
from torch.cuda.amp import custom_bwd, custom_fwd

class DCNv3Function(Function):
    @staticmethod
    @custom_fwd
    def forward(ctx, input, offset, mask, kernel_h, kernel_w, stride_h, stride_w, pad_h, pad_w, dilation_h, dilation_w, group, group_channels, offset_scale, im2col_step, remove_center):
        # ä¿å­˜å·ç§¯å‚æ•°åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œä»¥ä¾¿åœ¨åå‘ä¼ æ’­æ—¶ä½¿ç”¨
        ctx.kernel_h = kernel_h
        ctx.kernel_w = kernel_w
        ctx.stride_h = stride_h
        ctx.stride_w = stride_w
        ctx.pad_h = pad_h
        ctx.pad_w = pad_w
        ctx.dilation_h = dilation_h
        ctx.dilation_w = dilation_w
        ctx.group = group
        ctx.group_channels = group_channels
        ctx.offset_scale = offset_scale
        ctx.im2col_step = im2col_step
        ctx.remove_center = remove_center

        # è°ƒç”¨DCNv3çš„å‰å‘è®¡ç®—å‡½æ•°
        output = DCNv3.dcnv3_forward(input, offset, mask, kernel_h, kernel_w, stride_h, stride_w, pad_h, pad_w, dilation_h, dilation_w, group, group_channels, offset_scale, ctx.im2col_step)
        ctx.save_for_backward(input, offset, mask)  # ä¿å­˜è¾“å…¥å¼ é‡ä»¥ä¾¿åå‘ä¼ æ’­ä½¿ç”¨

        return output

    @staticmethod
    @once_differentiable
    @custom_bwd
    def backward(ctx, grad_output):
        # ä»ä¸Šä¸‹æ–‡ä¸­æ¢å¤ä¿å­˜çš„å¼ é‡
        input, offset, mask = ctx.saved_tensors

        # è°ƒç”¨DCNv3çš„åå‘è®¡ç®—å‡½æ•°
        grad_input, grad_offset, grad_mask = DCNv3.dcnv3_backward(input, offset, mask, ctx.kernel_h, ctx.kernel_w, ctx.stride_h, ctx.stride_w, ctx.pad_h, ctx.pad_w, ctx.dilation_h, ctx.dilation_w, ctx.group, ctx.group_channels, ctx.offset_scale, grad_output.contiguous(), ctx.im2col_step)

        return grad_input, grad_offset, grad_mask, None, None, None, None, None, None, None, None, None, None, None, None, None

def dcnv3_core_pytorch(input, offset, mask, kernel_h, kernel_w, stride_h, stride_w, pad_h, pad_w, dilation_h, dilation_w, group, group_channels, offset_scale, remove_center):
    # è¾“å…¥å¼ é‡è¿›è¡Œå¡«å……
    input = F.pad(input, [0, 0, pad_h, pad_h, pad_w, pad_w])
    N_, H_in, W_in, _ = input.shape  # è·å–è¾“å…¥çš„å½¢çŠ¶
    _, H_out, W_out, _ = offset.shape  # è·å–åç§»é‡çš„å½¢çŠ¶

    # è®¡ç®—å‚è€ƒç‚¹å’Œç½‘æ ¼
    ref = _get_reference_points(input.shape, input.device, kernel_h, kernel_w, dilation_h, dilation_w, pad_h, pad_w, stride_h, stride_w)
    grid = _generate_dilation_grids(input.shape, kernel_h, kernel_w, dilation_h, dilation_w, group, input.device)

    # è®¡ç®—é‡‡æ ·ä½ç½®
    sampling_locations = (ref + grid * offset_scale).repeat(N_, 1, 1, 1, 1)
    if remove_center:
        sampling_locations = remove_center_sampling_locations(sampling_locations, kernel_w=kernel_w, kernel_h=kernel_h)
    sampling_locations = sampling_locations.flatten(3, 4) + offset * offset_scale / torch.tensor([W_in, H_in]).reshape(1, 1, 1, 2).to(input.device)

    # ä½¿ç”¨grid_sampleè¿›è¡Œé‡‡æ ·
    sampling_input_ = F.grid_sample(input.view(N_, H_in * W_in, group * group_channels).transpose(1, 2).reshape(N_ * group, group_channels, H_in, W_in), sampling_locations, mode='bilinear', padding_mode='zeros', align_corners=False)

    # è®¡ç®—è¾“å‡º
    output = (sampling_input_ * mask.view(N_, H_out * W_out, group, -1).transpose(1, 2).reshape(N_ * group, 1, H_out * W_out, -1)).sum(-1).view(N_, group * group_channels, H_out * W_out)

    return output.transpose(1, 2).reshape(N_, H_out, W_out, -1).contiguous()
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **DCNv3Functionç±»**ï¼šè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„PyTorchå‡½æ•°ï¼ŒåŒ…å«å‰å‘å’Œåå‘ä¼ æ’­çš„å®ç°ã€‚
   - `forward`æ–¹æ³•ï¼šè´Ÿè´£è®¡ç®—å‰å‘ä¼ æ’­ï¼Œä¿å­˜å¿…è¦çš„å‚æ•°å’Œè¾“å…¥ä»¥ä¾¿åç»­åå‘ä¼ æ’­ä½¿ç”¨ã€‚
   - `backward`æ–¹æ³•ï¼šè´Ÿè´£è®¡ç®—åå‘ä¼ æ’­ï¼Œä½¿ç”¨ä¿å­˜çš„è¾“å…¥å’Œå‚æ•°æ¥è®¡ç®—æ¢¯åº¦ã€‚

2. **dcnv3_core_pytorchå‡½æ•°**ï¼šå®ç°äº†DCNv3çš„æ ¸å¿ƒè®¡ç®—é€»è¾‘ã€‚
   - é¦–å…ˆå¯¹è¾“å…¥è¿›è¡Œå¡«å……ã€‚
   - è®¡ç®—å‚è€ƒç‚¹å’Œé‡‡æ ·ç½‘æ ¼ã€‚
   - è®¡ç®—é‡‡æ ·ä½ç½®å¹¶è¿›è¡Œé‡‡æ ·ã€‚
   - æœ€åè®¡ç®—è¾“å‡ºç»“æœã€‚

3. **è¾…åŠ©å‡½æ•°**ï¼šå¦‚`_get_reference_points`å’Œ`_generate_dilation_grids`ç­‰ï¼Œè´Ÿè´£ç”Ÿæˆå‚è€ƒç‚¹å’Œè†¨èƒ€ç½‘æ ¼ï¼Œè¿™äº›éƒ½æ˜¯å®ç°DCNv3æ‰€éœ€çš„å…³é”®æ­¥éª¤ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ä¸€ä¸ªå®ç°æ·±åº¦å­¦ä¹ ä¸­å¯å˜å½¢å·ç§¯ï¼ˆDeformable Convolutionï¼‰V3ç‰ˆæœ¬çš„PyTorchå‡½æ•°çš„ä»£ç ã€‚è¯¥å®ç°ä¸»è¦ä¾èµ–äºä¸€ä¸ªåä¸ºDCNv3çš„å¤–éƒ¨åº“ï¼Œå¹¶æä¾›äº†å‰å‘å’Œåå‘ä¼ æ’­çš„åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬PyTorchå’Œç›¸å…³çš„åŠŸèƒ½æ¨¡å—ã€‚æ¥ç€ï¼Œå°è¯•å¯¼å…¥DCNv3åº“å¹¶è·å–å…¶ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨åç»­çš„æ“ä½œä¸­ä½¿ç”¨ã€‚

æ ¸å¿ƒç±»æ˜¯`DCNv3Function`ï¼Œå®ƒç»§æ‰¿è‡ª`torch.autograd.Function`ï¼Œå¹¶å®ç°äº†ä¸‰ä¸ªé™æ€æ–¹æ³•ï¼š`forward`ã€`backward`å’Œ`symbolic`ã€‚`forward`æ–¹æ³•ç”¨äºæ‰§è¡Œå‰å‘ä¼ æ’­ï¼Œæ¥æ”¶è¾“å…¥å¼ é‡ã€åç§»é‡ã€æ©ç ä»¥åŠå·ç§¯çš„å„ç§å‚æ•°ï¼ˆå¦‚æ ¸çš„å¤§å°ã€æ­¥å¹…ã€å¡«å……ç­‰ï¼‰ï¼Œå¹¶è°ƒç”¨DCNv3åº“ä¸­çš„å‰å‘å‡½æ•°æ¥è®¡ç®—è¾“å‡ºã€‚è¯¥æ–¹æ³•è¿˜ä¼šä¿å­˜è¾“å…¥ã€åç§»é‡å’Œæ©ç ï¼Œä»¥ä¾¿åœ¨åå‘ä¼ æ’­æ—¶ä½¿ç”¨ã€‚

`backward`æ–¹æ³•å®ç°äº†åå‘ä¼ æ’­çš„åŠŸèƒ½ï¼Œè®¡ç®—è¾“å…¥ã€åç§»é‡å’Œæ©ç çš„æ¢¯åº¦ã€‚å®ƒä½¿ç”¨äº†ä¿å­˜çš„å¼ é‡å’Œä¹‹å‰ä¼ å…¥çš„å‚æ•°æ¥è°ƒç”¨DCNv3åº“ä¸­çš„åå‘å‡½æ•°ã€‚

`symbolic`æ–¹æ³•ç”¨äºONNXï¼ˆå¼€æ”¾ç¥ç»ç½‘ç»œäº¤æ¢ï¼‰æ¨¡å‹çš„ç¬¦å·è¡¨ç¤ºï¼Œå…è®¸å°†è¿™ä¸ªè‡ªå®šä¹‰æ“ä½œå¯¼å‡ºä¸ºONNXæ ¼å¼ã€‚

æ¥ä¸‹æ¥ï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›è¾…åŠ©å‡½æ•°ï¼ŒåŒ…æ‹¬`_get_reference_points`ã€`_generate_dilation_grids`ã€`remove_center_sampling_locations`å’Œ`dcnv3_core_pytorch`ã€‚è¿™äº›å‡½æ•°åˆ†åˆ«ç”¨äºè®¡ç®—å‚è€ƒç‚¹ã€ç”Ÿæˆè†¨èƒ€ç½‘æ ¼ã€ç§»é™¤ä¸­å¿ƒé‡‡æ ·ä½ç½®ä»¥åŠå®ç°å¯å˜å½¢å·ç§¯çš„æ ¸å¿ƒé€»è¾‘ã€‚

åœ¨`dcnv3_core_pytorch`å‡½æ•°ä¸­ï¼Œé¦–å…ˆå¯¹è¾“å…¥è¿›è¡Œå¡«å……ï¼Œç„¶åè®¡ç®—å‚è€ƒç‚¹å’Œè†¨èƒ€ç½‘æ ¼ã€‚æ¥ç€ï¼Œæ ¹æ®ç»™å®šçš„åç§»é‡å’Œæ©ç è¿›è¡Œé‡‡æ ·ï¼Œæœ€åå°†ç»“æœè¿›è¡Œå¤„ç†å¹¶è¿”å›ã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç å®ç°äº†å¯å˜å½¢å·ç§¯çš„å‰å‘å’Œåå‘ä¼ æ’­è¿‡ç¨‹ï¼Œèƒ½å¤Ÿåœ¨æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­çµæ´»åœ°å¤„ç†ä¸åŒå½¢çŠ¶å’Œå°ºå¯¸çš„è¾“å…¥æ•°æ®ï¼Œæå‡æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥é¡¹ç›®ä¸»è¦å›´ç»•YOLOv8ï¼ˆYou Only Look Onceç‰ˆæœ¬8ï¼‰ç›®æ ‡æ£€æµ‹ç®—æ³•çš„å®ç°ä¸æ”¹è¿›ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ¨¡å—å’Œå·¥å…·ï¼Œç”¨äºæ¨¡å‹çš„è®­ç»ƒã€éªŒè¯ã€æ¨ç†ä»¥åŠå„ç§åŠŸèƒ½çš„æ‰©å±•ã€‚é¡¹ç›®ä¸­åŒ…å«äº†ä¸åŒçš„ç¥ç»ç½‘ç»œæ¶æ„ï¼ˆå¦‚RepVGGã€RepViTç­‰ï¼‰ã€æ•°æ®å¤„ç†ã€å¯å˜å½¢å·ç§¯ã€æ¨¡å‹è¯„ä¼°å’Œå¯è§†åŒ–ç­‰åŠŸèƒ½æ¨¡å—ã€‚æ•´ä½“æ¶æ„åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. **æ¨¡å‹æ„å»º**ï¼šå®ç°äº†YOLOv8åŠå…¶å˜ç§çš„æ¨¡å‹ç»“æ„ï¼ŒåŒ…æ‹¬ä¸åŒçš„éª¨å¹²ç½‘ç»œå’Œæ¨¡å—ï¼ˆå¦‚å¯å˜å½¢å·ç§¯ã€OREPAç­‰ï¼‰ã€‚
2. **è®­ç»ƒä¸éªŒè¯**ï¼šæä¾›äº†è®­ç»ƒå’ŒéªŒè¯çš„é€»è¾‘ï¼Œæ”¯æŒæ•°æ®é›†çš„æ„å»ºã€æŸå¤±è®¡ç®—ã€æŒ‡æ ‡è¯„ä¼°ç­‰ã€‚
3. **æ¨ç†ä¸åº”ç”¨**ï¼šå®ç°äº†æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹ï¼Œæ”¯æŒä¸åŒçš„è¾“å…¥æ ¼å¼å’Œè¾“å‡ºç»“æœã€‚
4. **å·¥å…·ä¸å®ç”¨åŠŸèƒ½**ï¼šåŒ…æ‹¬å¯è§†åŒ–ã€é”™è¯¯å¤„ç†ã€å›è°ƒå‡½æ•°ç­‰ï¼Œå¢å¼ºäº†æ¨¡å‹çš„å¯ç”¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                                                 | åŠŸèƒ½æè¿°                                                         |
|------------------------------------------------------------------------|------------------------------------------------------------------|
| `ultralytics/models/yolo/pose/val.py`                                  | å®ç°YOLOv8å§¿æ€ä¼°è®¡æ¨¡å‹çš„éªŒè¯é€»è¾‘ï¼ŒåŒ…æ‹¬æ•°æ®å¤„ç†å’ŒæŒ‡æ ‡è¯„ä¼°ã€‚       |
| `ultralytics/nn/extra_modules/orepa.py`                               | å®ç°OREPAå·ç§¯æ¨¡å—ï¼Œæå‡å·ç§¯ç¥ç»ç½‘ç»œçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚                |
| `ui.py`                                                                | æä¾›ä¸€ä¸ªæ¥å£æ¥è¿è¡ŒæŒ‡å®šçš„Pythonè„šæœ¬ï¼ˆå¦‚web.pyï¼‰ã€‚                 |
| `train.py`                                                             | è´Ÿè´£è®­ç»ƒYOLOç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€æŸå¤±è®¡ç®—å’Œè¿›åº¦ç›‘æ§ã€‚      |
| `ultralytics/nn/backbone/repvit.py`                                   | å®ç°RepViTæ¨¡å‹ï¼Œç»“åˆè§†è§‰å˜æ¢å™¨å’Œå·ç§¯çš„ç‰¹æ€§ã€‚                      |
| `ultralytics/nn/extra_modules/ops_dcnv3/functions/dcnv3_func.py`     | å®ç°å¯å˜å½¢å·ç§¯ï¼ˆDCNv3ï¼‰çš„å‰å‘å’Œåå‘ä¼ æ’­åŠŸèƒ½ã€‚                     |
| `code/ultralytics/solutions/speed_estimation.py`                      | å®ç°é€Ÿåº¦ä¼°è®¡çš„è§£å†³æ–¹æ¡ˆï¼Œå¯èƒ½ç”¨äºå®æ—¶åº”ç”¨ä¸­çš„æ€§èƒ½è¯„ä¼°ã€‚            |
| `code/ultralytics/models/yolo/segment/__init__.py`                   | YOLOåˆ†å‰²æ¨¡å‹çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œå¯èƒ½åŒ…å«åˆ†å‰²æ¨¡å‹çš„å®šä¹‰å’Œå¯¼å…¥ã€‚          |
| `ultralytics/utils/errors.py`                                         | å®šä¹‰é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç®¡ç†çš„å·¥å…·å‡½æ•°ã€‚                               |
| `code/ultralytics/utils/metrics.py`                                   | å®ç°æ¨¡å‹è¯„ä¼°æŒ‡æ ‡çš„è®¡ç®—å’Œç®¡ç†åŠŸèƒ½ã€‚                               |
| `ultralytics/utils/callbacks/tensorboard.py`                         | æä¾›ä¸TensorBoardé›†æˆçš„å›è°ƒå‡½æ•°ï¼Œç”¨äºå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ã€‚             |
| `code/ultralytics/models/yolo/pose/__init__.py`                      | YOLOå§¿æ€ä¼°è®¡æ¨¡å‹çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œå¯èƒ½åŒ…å«æ¨¡å‹çš„å®šä¹‰å’Œå¯¼å…¥ã€‚          |
| `ultralytics/nn/extra_modules/kernel_warehouse.py`                   | å®ç°å†…æ ¸ä»“åº“ç®¡ç†ï¼Œå¯èƒ½ç”¨äºå­˜å‚¨å’Œç®¡ç†ä¸åŒå·ç§¯æ ¸çš„åŠŸèƒ½ã€‚            |

ä»¥ä¸Šè¡¨æ ¼æ€»ç»“äº†é¡¹ç›®ä¸­å„ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œä¾¿äºç†è§£å’Œä½¿ç”¨è¯¥ä»£ç åº“ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/ZpyTmZht](https://mbd.pub/o/bread/ZpyTmZht)